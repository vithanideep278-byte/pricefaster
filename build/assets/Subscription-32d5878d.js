import{r as c,ao as va,j as s,ap as I,aq as T}from"./index-c61e8b64.js";import{B as ja,D as ba}from"./DeleteActionSvg-14c6b048.js";import{B as ka}from"./Button-fb2240eb.js";import{I as Aa}from"./Input-02b0842b.js";import{D as Pa}from"./DataTable-d852dcc0.js";import{S as Ca}from"./SearchIcon-598e1613.js";import{e as Ia,D as Ta}from"./exportExcel-576478c7.js";import"./context-ce67dbba.js";import"./Views-4c7db57f.js";import"./isNil-4bf62b3e.js";import"./get-6536235b.js";import"./toString-66698047.js";import"./Select-caf7af29.js";import"./slicedToArray-519bc2fc.js";import"./objectWithoutProperties-82d8236c.js";import"./_getPrototype-d4ebae27.js";const Ja=()=>{const[x,J]=c.useState(""),[E,M]=c.useState([]),[Q,B]=c.useState(!1),[f,z]=c.useState(1),[k,W]=c.useState(10),[X,L]=c.useState(0),[u,Z]=c.useState({key:"",order:""}),[A,m]=c.useState({}),aa=c.useMemo(()=>(E||[]).map(a=>{const n=(a.plan||"").toString().trim().toLowerCase(),e=n.includes("premium")||n.includes("professional")?"Active":A[a.id]??a.status;return{...a,status:e}}),[E,A]),d=a=>{if(!a)return"-";const n=new Date(a);return isNaN(n.getTime())?"-":n.toLocaleDateString()},R=a=>{if(!a)return"-";const n=new Date(a);return isNaN(n.getTime())?"-":n.toLocaleString(void 0,{month:"long",year:"numeric"})},ea=(a,n)=>{var p,S,g,w;const l=((S=(p=a==null?void 0:a.id)==null?void 0:p.toString)==null?void 0:S.call(p))||((w=(g=a==null?void 0:a._id)==null?void 0:g.toString)==null?void 0:w.call(g))||`${n}`,e=(a==null?void 0:a.user)||{},t=(a==null?void 0:a.subscription)||{},h=[e==null?void 0:e.first_name,e==null?void 0:e.last_name].filter(Boolean).join(" ").trim()||(e==null?void 0:e.name)||(e==null?void 0:e.userName)||"-",o=(e==null?void 0:e.email)||(a==null?void 0:a.email)||"-",i=(t==null?void 0:t.title)||(a==null?void 0:a.plan)||(a==null?void 0:a.plan_name)||"-",K=d(a==null?void 0:a.start_date),P=d((a==null?void 0:a.created_at)||(a==null?void 0:a.start_date)),C=R((a==null?void 0:a.start_date)||(a==null?void 0:a.created_at)),y=`${(a==null?void 0:a.status)||""}`.toLowerCase();return{id:l,userName:h,emailAddress:o,plan:i,paymentDate:P,startDate:K,successfulPaymentMonth:C,status:y==="active"?"Active":y==="suspended"?"Suspended":"Inactive"}},F=c.useCallback(async()=>{B(!0);try{const a=f<=1?0:f,n={limit:k,offset:a,search:x??"",sort:u.key||void 0,sort_order:u.order?u.order.toUpperCase():void 0},e=(await va.fetchData({url:"/admin/users/subscriptions/list",method:"post",data:n})).data;let t=[],r=0;if(Array.isArray(e))t=e,r=e.length;else if(e!=null&&e.data){const o=e.data;t=o.data||o.rows||o.list||o.items||[],r=o.total??e.total??t.length}else t=(e==null?void 0:e.rows)||(e==null?void 0:e.list)||(e==null?void 0:e.items)||[],r=(e==null?void 0:e.total)??t.length;const h=t.map((o,i)=>ea(o,i));M(h),L(typeof r=="number"?r:h.length)}catch{M([]),L(0)}finally{B(!1)}},[f,k,x,u]);c.useEffect(()=>{const a=setTimeout(()=>{F()},300);return()=>clearTimeout(a)},[F]);const ta=a=>{const n=(a.plan||"").trim().toLowerCase();if(!(n==="-"||n.includes("free"))){I.push(s.jsx(T,{type:"warning",duration:2500,title:"Not allowed",children:"Only Free plan or '-' users can be toggled. Premium/Professional remain Active."}),{placement:"top-end"});return}const e=A[a.id]??a.status;if(e!=="Active"&&e!=="Inactive"){I.push(s.jsx(T,{type:"warning",duration:2500,title:"Cannot toggle",children:"Only Active/Inactive users can be toggled."}),{placement:"top-end"});return}const t=e==="Active"?"Inactive":"Active";m(r=>({...r,[a.id]:t})),I.push(s.jsxs(T,{type:"success",duration:2e3,title:"Status updated",children:["Subscription status set to ",t,"."]}),{placement:"top-end"})},na=[{header:"User's Name",accessorKey:"userName",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("div",{className:"flex items-center",children:s.jsx("span",{className:"",children:n.userName})})}},{header:"Email Address",accessorKey:"emailAddress",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("span",{className:"",children:n.emailAddress})}},{header:"Plan",accessorKey:"plan",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("span",{className:"",children:n.plan})}},{header:"Payment Date",accessorKey:"paymentDate",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("span",{className:"",children:n.paymentDate})}},{header:"Start Date",accessorKey:"startDate",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("span",{className:"",children:n.startDate})}},{header:"Successful Payment Month",accessorKey:"successfulPaymentMonth",enableSorting:!0,cell:a=>{const n=a.row.original;return s.jsx("span",{className:"",children:n.successfulPaymentMonth})}},{header:"Status",accessorKey:"status",enableSorting:!0,meta:{headerAlign:"center"},cell:a=>{const n=a.row.original,l=e=>{switch(e){case"Active":return"rounded-[13.5px] bg-[#00C417] text-white text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";case"Suspended":return"rounded-[13.5px] bg-[#FF7308] text-white text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";case"Inactive":return"rounded-[13.5px] bg-[#E8E8E8] text-gray-800 text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";default:return"rounded-[13.5px] bg-[#E8E8E8] text-gray-800 text-[14px] font-bold leading-none font-nunito"}};return s.jsx(ja,{className:l(n.status),children:n.status})}},{header:"Action",accessorKey:"actions",meta:{headerAlign:"center"},cell:a=>{const n=a.row.original;return s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("div",{className:"flex bg-gray-100 rounded-lg border border-gray-200 overflow-hidden",children:s.jsx("button",{className:"p-[9px_8px_9px_12px] hover:bg-white transition-colors duration-200",onClick:()=>ta(n),children:s.jsx(ba,{})})})})}}],sa=a=>{z(a)},ra=a=>{W(a),z(1)},oa=a=>{Z(a)};return s.jsxs("div",{className:"min-h-screen w-full",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-3",children:[s.jsx("h1",{className:"text-[#202224] font-nunito text-[24px] font-bold leading-none tracking-[-0.114px]",children:"Subscriptions"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto sm:items-center",children:[s.jsxs("div",{className:"relative bg-white rounded-[35px] w-full sm:w-auto",children:[s.jsx(Ca,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),s.jsx(Aa,{type:"text",placeholder:"Search Users",value:x,onChange:a=>J(a.target.value),className:"pl-10  w-full sm:w-[253px] text-[#202224] font-normal text-[14px] leading-none font-nunito rounded-[19px] border border-[#D5D5D5] bg-white"})]}),s.jsx("div",{className:"flex flex-row gap-2 w-full sm:w-auto justify-end",children:s.jsxs(ka,{variant:"solid",size:"sm",className:"flex items-center text-white text-center font-nunito text-[12px] font-bold px-[16px] py-[11px] !rounded-[19px] !bg-[#4880FF]",onClick:async()=>{await Ia({endpoint:"/admin/users/subscriptions/list",filename:"subscriptions.csv",basePayload:{search:x??"",sort:u.key||void 0,sort_order:u.order?u.order.toUpperCase():void 0},limitPerPage:200,normalize:(a,n)=>{var N,$,D,V,_,q,v,Y,j,G,b,H;const l=(($=(N=a==null?void 0:a.id)==null?void 0:N.toString)==null?void 0:$.call(N))||((V=(D=a==null?void 0:a._id)==null?void 0:D.toString)==null?void 0:V.call(D))||`${n}`,e=l,t=(a==null?void 0:a.user)||{},r=(a==null?void 0:a.subscription)||{},h=((q=(_=t==null?void 0:t.id)==null?void 0:_.toString)==null?void 0:q.call(_))||((Y=(v=t==null?void 0:t._id)==null?void 0:v.toString)==null?void 0:Y.call(v))||"-",o=(t==null?void 0:t.first_name)||"-",i=(t==null?void 0:t.last_name)||"-",P=[o,i].filter(Boolean).join(" ").trim()||(t==null?void 0:t.name)||(t==null?void 0:t.userName)||"-",C=(t==null?void 0:t.email)||(a==null?void 0:a.email)||"-",y=(r==null?void 0:r.title)||(a==null?void 0:a.plan)||(a==null?void 0:a.plan_name)||"-",U=((G=(j=r==null?void 0:r.id)==null?void 0:j.toString)==null?void 0:G.call(j))||((H=(b=a==null?void 0:a.plan_id)==null?void 0:b.toString)==null?void 0:H.call(b))||"-",p=(a==null?void 0:a.amount)??(a==null?void 0:a.price),S=p==null?"-":`${p}`,g=(a==null?void 0:a.currency)||"-",w=d(a==null?void 0:a.start_date),ca=d((a==null?void 0:a.created_at)||(a==null?void 0:a.start_date)),la=d((a==null?void 0:a.renewal_date)||(a==null?void 0:a.end_date)),da=d(a==null?void 0:a.next_billing_date),ua=R((a==null?void 0:a.start_date)||(a==null?void 0:a.created_at)),O=`${(a==null?void 0:a.status)||""}`.toLowerCase(),pa=O==="active"?"Active":O==="suspended"?"Suspended":"Inactive",ha=(a==null?void 0:a.status_reason)||"-",ia=(a==null?void 0:a.payment_method)||"-",ga=(a==null?void 0:a.transaction_id)||"-",xa=(a==null?void 0:a.coupon_code)||"-",fa=d(a==null?void 0:a.trial_start_date),ya=d(a==null?void 0:a.trial_end_date),Sa=typeof(a==null?void 0:a.auto_renew)=="boolean"?a.auto_renew?"True":"False":"-",wa=(t==null?void 0:t.country)||"-",Na=(t==null?void 0:t.city)||"-",Da=a!=null&&a.created_at?new Date(a.created_at).toLocaleString():"-",_a=a!=null&&a.updated_at?new Date(a.updated_at).toLocaleString():"-";return{id:l,subscriptionId:e,userId:h,userName:P,firstName:o,lastName:i,emailAddress:C,plan:y,planId:U,amount:S,currency:g,paymentDate:ca,startDate:w,renewalDate:la,nextBillingDate:da,successfulPaymentMonth:ua,status:pa,statusReason:ha,paymentMethod:ia,transactionId:ga,couponCode:xa,trialStartDate:fa,trialEndDate:ya,autoRenew:Sa,country:wa,city:Na,createdAt:Da,updatedAt:_a}},columns:[{header:"Subscription ID",key:"subscriptionId"},{header:"User ID",key:"userId"},{header:"User's Name",key:"userName"},{header:"First Name",key:"firstName"},{header:"Last Name",key:"lastName"},{header:"Email Address",key:"emailAddress"},{header:"Plan",key:"plan"},{header:"Plan ID",key:"planId"},{header:"Amount",key:"amount"},{header:"Currency",key:"currency"},{header:"Payment Date",key:"paymentDate"},{header:"Start Date",key:"startDate"},{header:"Renewal Date",key:"renewalDate"},{header:"Next Billing Date",key:"nextBillingDate"},{header:"Successful Payment Month",key:"successfulPaymentMonth"},{header:"Status",key:"status"},{header:"Status Reason",key:"statusReason"},{header:"Payment Method",key:"paymentMethod"},{header:"Transaction ID",key:"transactionId"},{header:"Coupon Code",key:"couponCode"},{header:"Trial Start",key:"trialStartDate"},{header:"Trial End",key:"trialEndDate"},{header:"Auto Renew",key:"autoRenew"},{header:"Country",key:"country"},{header:"City",key:"city"},{header:"Created At",key:"createdAt"},{header:"Updated At",key:"updatedAt"}]})},children:["Download",s.jsx(Ta,{className:"ml-2",size:16})]})})]})]}),s.jsx("div",{className:"",children:s.jsx(Pa,{columns:na,data:aa,loading:Q,onPaginationChange:sa,onSelectChange:ra,onSort:oa,pageSizes:[10,25,50],pagingData:{total:X,pageIndex:f,pageSize:k}})})]})};export{Ja as default};
