import{b as Ee,u as Ae,r as i,at as X,au as Pe,av as Y,j as t,ao as Ie,ap as m,aq as p,aw as ke,ax as Le}from"./index-c61e8b64.js";import{C as g}from"./Card-28ca2a97.js";import{B as Te,D as Fe}from"./DeleteActionSvg-14c6b048.js";import{B as S}from"./Button-fb2240eb.js";import{I as u}from"./Input-02b0842b.js";import{D as Oe}from"./DataTable-d852dcc0.js";import{D as Ue}from"./Dialog-bacfacb3.js";import{S as we}from"./Select-caf7af29.js";import{S as ze}from"./SearchIcon-598e1613.js";import{e as Be,D as Ke}from"./exportExcel-576478c7.js";import{E as Me}from"./EditPencilSvg-093d76fc.js";import"./context-ce67dbba.js";import"./Views-4c7db57f.js";import"./isNil-4bf62b3e.js";import"./get-6536235b.js";import"./toString-66698047.js";import"./_getPrototype-d4ebae27.js";import"./index-499f6fa2.js";import"./index-69d6aa2e.js";import"./warning-800900b9.js";import"./slicedToArray-519bc2fc.js";import"./objectWithoutProperties-82d8236c.js";const dt=()=>{const r=Ee(),{items:_,loading:Z,total:$,pageIndex:D,pageSize:C,sort:c,search:E}=Ae(s=>s.userManagement.list),[h,ee]=i.useState(""),[te,x]=i.useState(!1),[se,f]=i.useState(!1),[A,b]=i.useState(void 0),[P,ae]=i.useState(""),[I,k]=i.useState(""),[L,T]=i.useState(""),[F,ne]=i.useState(""),[O,U]=i.useState(""),[N,w]=i.useState(!1),[j,ie]=i.useState({}),le=i.useMemo(()=>(_||[]).map(s=>{const a=(s.plan||"").toString().trim().toLowerCase(),n=a.includes("premium")||a.includes("professional")?"Active":j[s.id]??s.status;return{...s,status:n}}),[_,j]),oe=(s,a)=>{x(!0),b(void 0),ae(s),f(!1);const l=((a==null?void 0:a.userName)||"").split(" ");k(l[0]||""),T(l.slice(1).join(" ")||""),ne((a==null?void 0:a.email)||""),U((a==null?void 0:a.mobileNo)||"");const n=((a==null?void 0:a.status)||"").toLowerCase();w(n==="active")},re=async()=>{var s,a,l,n;f(!0),b(void 0);try{const e=Number(P),o={user_id:Number.isFinite(e)?e:P,first_name:I,last_name:L,email:F,phone:O,status:N},v=await Ie.fetchData({url:"/admin/users/edit",method:"post",data:o}),d=((s=v.data)==null?void 0:s.message)||((a=v.data)==null?void 0:a.msg)||"User updated successfully";m.push(t.jsx(p,{type:"success",duration:2500,title:"Success",children:d}),{placement:"top-end"}),x(!1),r(X())}catch(e){const o=((n=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:n.message)||(e==null?void 0:e.message)||"Failed to update user";b(o),m.push(t.jsx(p,{type:"danger",duration:3e3,title:"Error",children:o}),{placement:"top-end"})}finally{f(!1)}},ce=s=>{const a=(s.plan||"").trim().toLowerCase();if(!(a==="-"||a.includes("free"))){m.push(t.jsx(p,{type:"warning",duration:2500,title:"Not allowed",children:"Only Free plan or '-' users can be toggled. Premium/Professional remain Active."}),{placement:"top-end"});return}const n=j[s.id]??s.status;if(n!=="Active"&&n!=="Inactive"){m.push(t.jsx(p,{type:"warning",duration:2500,title:"Cannot toggle",children:"Only Active/Inactive users can be toggled."}),{placement:"top-end"});return}const e=n==="Active"?"Inactive":"Active";ie(o=>({...o,[s.id]:e})),m.push(t.jsxs(p,{type:"success",duration:2e3,title:"Status updated",children:["User status set to ",e,"."]}),{placement:"top-end"})};i.useEffect(()=>{r(X())},[D,C,c,E]);const de=[{header:"User's Name",accessorKey:"userName",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("div",{className:"flex items-center",children:t.jsx("span",{className:"",children:a.userName})})}},{header:"Email Id",accessorKey:"email",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("span",{className:"",children:a.email})}},{header:"Mobile No.",accessorKey:"mobileNo",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("span",{className:"",children:a.mobileNo})}},{header:"Sign Up Date",accessorKey:"signUpDate",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("span",{className:"",children:a.signUpDate})}},{header:"Cancelation Date",accessorKey:"cancelationDate",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("span",{className:"",children:a.cancelationDate})}},{header:"Plan",accessorKey:"plan",enableSorting:!0,cell:s=>{const a=s.row.original;return t.jsx("span",{className:"",children:a.plan})}},{header:"Status",accessorKey:"status",enableSorting:!0,meta:{headerAlign:"center"},cell:s=>{const a=s.row.original,l=n=>{switch(n){case"Active":return"rounded-[13.5px] bg-[#00C417] text-white text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";case"Suspended":return"rounded-[13.5px] bg-[#FF7308] text-white text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";case"Inactive":return"rounded-[13.5px] bg-[#E8E8E8] text-gray-800 text-[14px] font-bold leading-none font-nunito px-[26px] py-[8px] flex justify-center";default:return"rounded-[13.5px] bg-[#E8E8E8] text-gray-800 text-[14px] font-bold leading-none font-nunito"}};return t.jsx(Te,{className:l(a.status),children:a.status})}},{header:"Action",accessorKey:"actions",meta:{headerAlign:"center"},cell:s=>{const a=s.row.original;return t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"flex bg-gray-100 rounded-lg border border-gray-200 overflow-hidden",children:[t.jsx("button",{className:"p-[9px_8px_9px_12px] hover:bg-white border-r border-gray-200 transition-colors duration-200",onClick:()=>oe(a.id,a),children:t.jsx(Me,{})}),t.jsx("button",{className:"p-[9px_8px_9px_12px] hover:bg-white transition-colors duration-200",onClick:()=>ce(a),children:t.jsx(Fe,{})})]})})}}],me=s=>{r(Y(s))},pe=s=>{r(ke(s))},ue=s=>{r(Le(s))};return i.useEffect(()=>{const s=setTimeout(()=>{r(Pe(h)),r(Y(1))},300);return()=>clearTimeout(s)},[h]),t.jsxs("div",{className:"min-h-screen w-full",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-3",children:[t.jsx("h1",{className:"text-[#202224] font-nunito text-[24px] font-bold leading-none tracking-[-0.114px]",children:"User Management"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto sm:items-center",children:[t.jsxs("div",{className:"relative bg-white rounded-[35px] w-full sm:w-auto",children:[t.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),t.jsx(u,{type:"text",placeholder:"Search Users",value:h,onChange:s=>ee(s.target.value),className:"pl-10 w-full sm:w-[253px] text-[#202224] font-normal text-[14px] leading-none font-nunito rounded-[19px] border border-[#D5D5D5] bg-white"})]}),t.jsx("div",{className:"flex flex-row gap-2 w-full sm:w-auto justify-end",children:t.jsxs(S,{variant:"solid",size:"sm",className:"flex items-center justify-center text-white text-center font-nunito text-[12px] font-bold px-[16px] py-[11px] !rounded-[19px] !bg-[#4880FF] w-full sm:w-auto",onClick:async()=>{var s,a;await Be({endpoint:"/admin/users/list",filename:"users.csv",basePayload:{search:E||"",sort:(c==null?void 0:c.key)||"created_at",sort_order:((a=(s=c==null?void 0:c.order)==null?void 0:s.toUpperCase)==null?void 0:a.call(s))||"DESC"},limitPerPage:200,normalize:(l,n)=>{var z,B,K,M,R,G,q,V,H,J,Q;const e=l||{},o=String((e==null?void 0:e.id)??(e==null?void 0:e._id)??n),d=[e==null?void 0:e.first_name,e==null?void 0:e.last_name].filter(Boolean).join(" ").trim()||(e==null?void 0:e.userName)||(e==null?void 0:e.name)||"-",xe=(e==null?void 0:e.first_name)||(d?String(d).split(" ")[0]:"-")||"-",ge=(e==null?void 0:e.last_name)||(d?String(d).split(" ").slice(1).join(" "):"-")||"-",he=(e==null?void 0:e.email)||(e==null?void 0:e.emailAddress)||"-",fe=(e==null?void 0:e.phone)||(e==null?void 0:e.mobile)||(e==null?void 0:e.mobileNo)||"-",be=e!=null&&e.created_at?new Date(e.created_at).toLocaleDateString():(e==null?void 0:e.signUpDate)||"-",Ne=(e==null?void 0:e.cancelationDate)||(e!=null&&e.deleted_at?new Date(e.deleted_at).toLocaleDateString():"-"),je=((B=(z=e==null?void 0:e.user_subscriptions)==null?void 0:z.subscription)==null?void 0:B.title)||(e==null?void 0:e.plan)||"-";let y="Inactive";if(typeof(e==null?void 0:e.status)=="boolean")y=e.status?"Active":"Inactive";else if(typeof(e==null?void 0:e.status)=="string"){const W=e.status.toLowerCase();y=W==="active"?"Active":W==="suspended"?"Suspended":"Inactive"}const ve=((M=(K=e==null?void 0:e.user_subscriptions)==null?void 0:K.subscription)==null?void 0:M.title)||((R=e==null?void 0:e.subscription)==null?void 0:R.title)||"-",ye=((G=e==null?void 0:e.user_subscriptions)==null?void 0:G.status)||((q=e==null?void 0:e.subscription)==null?void 0:q.status)||"-",Se=((V=e==null?void 0:e.user_subscriptions)==null?void 0:V.start_date)||((H=e==null?void 0:e.subscription)==null?void 0:H.start_date)||"-",_e=((J=e==null?void 0:e.user_subscriptions)==null?void 0:J.end_date)||((Q=e==null?void 0:e.subscription)==null?void 0:Q.end_date)||"-",De=(e==null?void 0:e.last_login)||(e==null?void 0:e.lastLogin)||"-",Ce=(e==null?void 0:e.role)||(e==null?void 0:e.user_role)||"-";return{id:o,userName:d,firstName:xe,lastName:ge,email:he,mobileNo:fe,signUpDate:be,cancelationDate:Ne,plan:je,status:y,subscriptionTitle:ve,subscriptionStatus:ye,subscriptionStartDate:Se,subscriptionEndDate:_e,lastLogin:De,role:Ce}},columns:[{header:"User ID",key:"id"},{header:"User's Name",key:"userName"},{header:"First Name",key:"firstName"},{header:"Last Name",key:"lastName"},{header:"Email",key:"email"},{header:"Mobile No.",key:"mobileNo"},{header:"Sign Up Date",key:"signUpDate"},{header:"Cancelation Date",key:"cancelationDate"},{header:"Plan",key:"plan"},{header:"Status",key:"status"},{header:"Subscription Title",key:"subscriptionTitle"},{header:"Subscription Status",key:"subscriptionStatus"},{header:"Subscription Start",key:"subscriptionStartDate"},{header:"Subscription End",key:"subscriptionEndDate"},{header:"Last Login",key:"lastLogin"},{header:"Role",key:"role"}]})},children:["Download",t.jsx(Ke,{className:"ml-2",size:16})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-12 gap-6 mb-6",children:[t.jsx(g,{className:"bg-white rounded-[14px] shadow-[6px_6px_54px_0_rgba(0,0,0,0.05)] col-span-1 md:col-span-3 lg:col-span-4 xl:col-span-3",children:t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"flex justify-between items-start ",children:[t.jsxs("div",{className:"",children:[t.jsx("h3",{className:"text-[#202224] font-nunito text-[18px] font-bold leading-normal tracking-[-0.114px] opacity-70 mb-[16px]",children:"Total Users"}),t.jsx("span",{className:"text-[#202224] font-nunito text-[28px] not-italic font-bold leading-none tracking-[1px]",children:"40,689"})]}),t.jsx("div",{className:" rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/img/images/totaluser.png",alt:"Total Users",className:""})})]})})}),t.jsx(g,{className:"bg-white rounded-[14px] shadow-[6px_6px_54px_0_rgba(0,0,0,0.05)] col-span-1 md:col-span-3 lg:col-span-4 xl:col-span-3",children:t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"flex justify-between items-start ",children:[t.jsxs("div",{className:"",children:[t.jsx("h3",{className:"text-[#202224] font-nunito text-[18px] font-bold leading-normal tracking-[-0.114px] opacity-70 mb-[16px]",children:"Active Users"}),t.jsx("span",{className:"text-[#202224] font-nunito text-[28px] not-italic font-bold leading-none tracking-[1px]",children:"10,293"})]}),t.jsx("div",{className:" rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/img/images/activeuser.png",alt:"Active Users",className:""})})]})})}),t.jsx(g,{className:"bg-white rounded-[14px] shadow-[6px_6px_54px_0_rgba(0,0,0,0.05)] col-span-1 md:col-span-3 lg:col-span-4 xl:col-span-3",children:t.jsx("div",{className:" relative",children:t.jsxs("div",{className:"flex justify-between items-start ",children:[t.jsxs("div",{className:"",children:[t.jsx("h3",{className:"text-[#202224] font-nunito text-[18px] font-bold leading-normal tracking-[-0.114px] opacity-70 mb-[16px]",children:"User Growth"}),t.jsx("span",{className:"text-[#202224] font-nunito text-[28px] not-italic font-bold leading-none tracking-[1px]",children:"60%"})]}),t.jsx("div",{className:" rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/img/images/growthuser.png",alt:"User Growth",className:""})})]})})}),t.jsx(g,{className:"bg-white rounded-[14px] shadow-[6px_6px_54px_0_rgba(0,0,0,0.05)] col-span-1 md:col-span-3 lg:col-span-4 xl:col-span-3",children:t.jsx("div",{className:" relative",children:t.jsxs("div",{className:"flex justify-between items-start ",children:[t.jsxs("div",{className:"",children:[t.jsx("h3",{className:"text-[#202224] font-nunito text-[18px] font-bold leading-normal tracking-[-0.114px] opacity-70 mb-[16px]",children:"Churn Rate"}),t.jsx("span",{className:"text-[#202224] font-nunito text-[28px] not-italic font-bold leading-none tracking-[1px]",children:"67%"})]}),t.jsx("div",{className:" rounded-lg flex items-center justify-center",children:t.jsx("img",{src:"/img/images/monthlyuser.png",alt:"Churn Rate",className:""})})]})})})]}),t.jsx("div",{className:"",children:t.jsx(Oe,{columns:de,data:le,loading:Z,onPaginationChange:me,onSelectChange:pe,onSort:ue,pageSizes:[10,25,50],pagingData:{total:$,pageIndex:D,pageSize:C}})}),t.jsx(Ue,{isOpen:te,onClose:()=>x(!1),width:640,children:t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:"text-[#202224] font-nunito text-[20px] font-bold leading-none mb-4",children:"Edit User"}),A&&t.jsx("div",{className:"text-red-500 text-sm mb-3",children:A}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"First Name"}),t.jsx(u,{value:I,onChange:s=>k(s.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Last Name"}),t.jsx(u,{value:L,onChange:s=>T(s.target.value)})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Email"}),t.jsx(u,{value:F,readOnly:!0,className:"bg-gray-100"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Phone"}),t.jsx(u,{value:O,onChange:s=>U(s.target.value)})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Active"}),t.jsx(we,{isSearchable:!1,value:{value:N,label:N?"True":"False"},options:[{value:!0,label:"True"},{value:!1,label:"False"}],onChange:s=>w(!!(s!=null&&s.value))})]})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx(S,{variant:"default",onClick:()=>x(!1),children:"Cancel"}),t.jsx(S,{variant:"solid",className:"!bg-[#4880FF]",disabled:se,onClick:re,children:"Save Changes"})]})]})})]})};export{dt as default};
