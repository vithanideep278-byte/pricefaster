import{r as u,ao as ra,j as o}from"./index-c61e8b64.js";import{B as na}from"./Button-fb2240eb.js";import{I as oa}from"./Input-02b0842b.js";import{D as sa}from"./DataTable-d852dcc0.js";import{S as ca}from"./SearchIcon-598e1613.js";import{e as la,D as ea}from"./exportExcel-576478c7.js";import"./context-ce67dbba.js";import"./Views-4c7db57f.js";import"./isNil-4bf62b3e.js";import"./get-6536235b.js";import"./toString-66698047.js";import"./Select-caf7af29.js";import"./slicedToArray-519bc2fc.js";import"./objectWithoutProperties-82d8236c.js";import"./_getPrototype-d4ebae27.js";const ba=()=>{const[y,E]=u.useState(""),[$,D]=u.useState([]),[U,P]=u.useState(!1),[x,A]=u.useState(1),[C,Y]=u.useState(10),[q,I]=u.useState(0),[t,G]=u.useState({key:"",order:""}),V=a=>{if(!a)return"-";const r=new Date(a);return isNaN(r.getTime())?"-":r.toLocaleDateString()},z=a=>{if(!a)return"-";const r=new Date(a);return isNaN(r.getTime())?"-":r.toLocaleString(void 0,{month:"long",year:"numeric"})},H=(a,r)=>{var g,e,s,S;const w=((e=(g=a==null?void 0:a.id)==null?void 0:g.toString)==null?void 0:e.call(g))||((S=(s=a==null?void 0:a._id)==null?void 0:s.toString)==null?void 0:S.call(s))||`${r}`,n=(a==null?void 0:a.metricName)||(a==null?void 0:a.metric_name)||(a==null?void 0:a.metric)||(a==null?void 0:a.name)||"-",l=(a==null?void 0:a.month)||z((a==null?void 0:a.date)||(a==null?void 0:a.created_at)||(a==null?void 0:a.period_start)||(a==null?void 0:a.period)),d=(a==null?void 0:a.plan)||(a==null?void 0:a.plan_name)||(a==null?void 0:a.tier)||"-",p=(a==null?void 0:a.location)||(a==null?void 0:a.city_state)||[a==null?void 0:a.city,a==null?void 0:a.state].filter(Boolean).join(", ")||"-",c=(a==null?void 0:a.currentValue)||(a==null?void 0:a.current_value)||(a==null?void 0:a.current)||(a==null?void 0:a.value),h=(a==null?void 0:a.lastMonth)||(a==null?void 0:a.last_month)||(a==null?void 0:a.previous_value)||(a==null?void 0:a.previous),b=typeof c=="number"?c.toString():c??"-",j=typeof h=="number"?h.toString():h??"-",f=(a==null?void 0:a.metricsChange)||(a==null?void 0:a.change)||(a==null?void 0:a.change_percent)||(a==null?void 0:a.changePercentage),v=typeof f=="number"?`${f}%`:f??"-";return{id:w,metricName:n,month:l,plan:d,location:p,currentValue:b,lastMonth:j,metricsChange:v}},L=u.useCallback(async()=>{P(!0);try{const a=x<=1?0:x,r={limit:C,offset:a,search:y??"",sort:t.key||void 0,sort_order:t.order?t.order.toUpperCase():void 0},n=(await ra.fetchData({url:"/admin/metrics/financial",method:"post",data:r})).data;let l=[],d=0;if(Array.isArray(n))l=n,d=n.length;else if(n!=null&&n.data){const c=n.data;l=c.data||c.rows||c.list||c.items||[],d=c.total??n.total??l.length}else l=(n==null?void 0:n.rows)||(n==null?void 0:n.list)||(n==null?void 0:n.items)||[],d=(n==null?void 0:n.total)??l.length;const p=l.map((c,h)=>H(c,h));D(p),I(typeof d=="number"?d:p.length)}catch{D([]),I(0)}finally{P(!1)}},[x,C,y,t]);u.useEffect(()=>{const a=setTimeout(()=>{L()},300);return()=>clearTimeout(a)},[L]);const J=[{header:"Metric Name",accessorKey:"metricName",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("div",{className:"flex items-center",children:o.jsx("span",{className:"",children:r.metricName})})}},{header:"Month",accessorKey:"month",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.month})}},{header:"Plan",accessorKey:"plan",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.plan})}},{header:"Location",accessorKey:"location",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.location})}},{header:"Current Value",accessorKey:"currentValue",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.currentValue})}},{header:"Last Month",accessorKey:"lastMonth",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.lastMonth})}},{header:"Metrics Change",accessorKey:"metricsChange",enableSorting:!0,cell:a=>{const r=a.row.original;return o.jsx("span",{className:"",children:r.metricsChange})}}];return o.jsxs("div",{className:"min-h-screen w-full",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-3",children:[o.jsx("h1",{className:"text-[#202224] font-nunito text-[24px] font-bold leading-none tracking-[-0.114px]",children:"Financial Metrics"}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto sm:items-center",children:[o.jsxs("div",{className:"relative bg-white rounded-[35px] w-full sm:w-auto",children:[o.jsx(ca,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),o.jsx(oa,{type:"text",placeholder:"Search Users",value:y,onChange:a=>E(a.target.value),className:"pl-10 w-full sm:w-[253px] text-[#202224] font-normal text-[14px] leading-none font-nunito rounded-[19px] border border-[#D5D5D5] bg-white"})]}),o.jsx("div",{className:"flex flex-row gap-2 w-full sm:w-auto justify-end",children:o.jsxs(na,{variant:"solid",size:"sm",className:"flex items-center text-white text-center font-nunito text-[12px] font-bold px-[16px] py-[11px] !rounded-[19px] !bg-[#4880FF] ",onClick:async()=>{await la({endpoint:"/admin/metrics/financial",filename:"financial-metrics.csv",basePayload:{search:y??"",sort:t.key||void 0,sort_order:t.order?t.order.toUpperCase():void 0},limitPerPage:200,normalize:(a,r)=>{var N,K,_,R,k,B;const w=((K=(N=a==null?void 0:a.id)==null?void 0:N.toString)==null?void 0:K.call(N))||((R=(_=a==null?void 0:a._id)==null?void 0:_.toString)==null?void 0:R.call(_))||`${r}`,n=(a==null?void 0:a.metricName)||(a==null?void 0:a.metric_name)||(a==null?void 0:a.metric)||(a==null?void 0:a.name)||"-",l=(a==null?void 0:a.metric_code)||(a==null?void 0:a.code)||"-",d=(a==null?void 0:a.month)||z((a==null?void 0:a.date)||(a==null?void 0:a.created_at)||(a==null?void 0:a.period_start)||(a==null?void 0:a.period)),p=V((a==null?void 0:a.period_start)||(a==null?void 0:a.start_date)),c=V((a==null?void 0:a.period_end)||(a==null?void 0:a.end_date)),h=(a==null?void 0:a.plan)||(a==null?void 0:a.plan_name)||(a==null?void 0:a.tier)||"-",b=((B=(k=a==null?void 0:a.plan_id)==null?void 0:k.toString)==null?void 0:B.call(k))||"-",j=(a==null?void 0:a.location)||(a==null?void 0:a.city_state)||[a==null?void 0:a.city,a==null?void 0:a.state].filter(Boolean).join(", ")||"-",f=(a==null?void 0:a.city)||"-",v=(a==null?void 0:a.state)||"-",g=(a==null?void 0:a.country)||"-",e=(a==null?void 0:a.currentValue)||(a==null?void 0:a.current_value)||(a==null?void 0:a.current)||(a==null?void 0:a.value),s=(a==null?void 0:a.lastMonth)||(a==null?void 0:a.last_month)||(a==null?void 0:a.previous_value)||(a==null?void 0:a.previous),S=typeof e=="number"?e.toString():e??"-",O=typeof s=="number"?s.toString():s??"-",T=typeof e=="number"&&typeof s=="number"?e-s:null,Q=T==null?"-":T.toString(),F=typeof e=="number"&&typeof s=="number"&&s!==0?(e-s)/s*100:null,W=F==null?"-":`${F.toFixed(2)}%`,M=(a==null?void 0:a.metricsChange)||(a==null?void 0:a.change)||(a==null?void 0:a.change_percent)||(a==null?void 0:a.changePercentage),X=typeof M=="number"?`${M}%`:M??"-",Z=(a==null?void 0:a.currency)||"-",i=(a==null?void 0:a.source)||(a==null?void 0:a.origin)||"-",m=a!=null&&a.created_at?new Date(a.created_at).toLocaleString():"-",aa=a!=null&&a.updated_at?new Date(a.updated_at).toLocaleString():"-";return{id:w,metricName:n,metricCode:l,month:d,periodStart:p,periodEnd:c,plan:h,planId:b,location:j,city:f,state:v,country:g,currentValue:S,lastMonth:O,changeAbsolute:Q,changePercent:W,metricsChange:X,currency:Z,source:i,createdAt:m,updatedAt:aa}},columns:[{header:"Metric ID",key:"id"},{header:"Metric Name",key:"metricName"},{header:"Metric Code",key:"metricCode"},{header:"Month",key:"month"},{header:"Period Start",key:"periodStart"},{header:"Period End",key:"periodEnd"},{header:"Plan",key:"plan"},{header:"Plan ID",key:"planId"},{header:"Location",key:"location"},{header:"City",key:"city"},{header:"State",key:"state"},{header:"Country",key:"country"},{header:"Current Value",key:"currentValue"},{header:"Last Month",key:"lastMonth"},{header:"Change (Abs)",key:"changeAbsolute"},{header:"Change (%)",key:"changePercent"},{header:"Metrics Change",key:"metricsChange"},{header:"Currency",key:"currency"},{header:"Source",key:"source"},{header:"Created At",key:"createdAt"},{header:"Updated At",key:"updatedAt"}]})},children:["Download",o.jsx(ea,{className:"ml-2",size:16})]})})]})]}),o.jsx("div",{className:"",children:o.jsx(sa,{columns:J,data:$,loading:U,onPaginationChange:a=>A(a),onSelectChange:a=>{Y(a),A(1)},onSort:a=>G(a),pageSizes:[10,25,50],pagingData:{total:q,pageIndex:x,pageSize:C}})})]})};export{ba as default};
